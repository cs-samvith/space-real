trigger:
  batch: true
  branches:
    include:
      - main
  paths:
    include:
      - /cluster-config/aks/*

pr: none

pool:
  vmImage: ubuntu-latest

variables:
  service_connection: ARM_SERVICE_CONNECTION
  kubernetesServiceConnection: "spaceaks"
  k8sNamespace: "default"

stages:
  - stage: Dev
    jobs:
      - job: EnvironmentConfig
        steps:
          - task: KubernetesManifest@0
            displayName: Deploy Cluster Config to Kubernetes cluster
            inputs:
              action: deploy
              namespace: $(k8sNamespace)
              kubernetesServiceConnection: $(kubernetesServiceConnection)
              manifests: |
                $(System.DefaultWorkingDirectory)/cluster-config/aks/manifests/dev/01-namespace.yml
  - stage: Qa
    dependsOn:
      - Dev
    jobs:
      - job: EnvironmentConfig
        steps:
          - task: KubernetesManifest@0
            displayName: Deploy Cluster Config to Kubernetes cluster
            inputs:
              action: deploy
              namespace: $(k8sNamespace)
              kubernetesServiceConnection: $(kubernetesServiceConnection)
              manifests: |
                $(System.DefaultWorkingDirectory)/cluster-config/aks/manifests/qa/01-namespace.yml
